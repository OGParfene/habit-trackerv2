<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario de Actividades</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .highlight { background-color: #fbbf24; color: white; }
        .header-day { background-color: #2563EB; color: white; }
        .hidden-weight { display: none; }
        .food-good { background-color: #22c55e; color: white; }
        .food-improvable { background-color: #93c5fd; color: white; }
        .food-normal { background-color: #f97316; color: white; }
        .food-bad { background-color: #ef4444; color: white; }

        /* Estilo para el día actual */
        .current-day {
            background-color: #f3f4f6;
        }

        /* Estilos para las gráficas en el resumen */
        .stat-bar {
            height: 10px;
            background-color: #e5e7eb;
            border-radius: 5px;
            margin-top: 4px;
        }

        .stat-progress {
            height: 100%;
            border-radius: 5px;
        }

        .stat-good { background-color: #22c55e; }
        .stat-improvable { background-color: #93c5fd; }
        .stat-normal { background-color: #f97316; }
        .stat-bad { background-color: #ef4444; }
        .stat-sport { background-color: #2563eb; }
    </style>
</head>
<body class="bg-gray-100">

<!-- Barra de navegación -->
<div class="bg-blue-600 text-white p-4 flex justify-between items-center">
    <div class="flex items-center">
        <button onclick="changeMonth(-1)" class="mr-4 p-2 rounded bg-blue-500 hover:bg-blue-400">←</button>
        <h1 id="month-title" class="text-xl font-semibold"></h1>
        <button onclick="changeMonth(1)" class="ml-4 p-2 rounded bg-blue-500 hover:bg-blue-400">→</button>
    </div>
    <div>
        <span id="current-date" class="text-lg"></span>
    </div>
</div>

<!-- Botón para alternar entre calendario y resumen -->
<div class="p-4">
    <button onclick="toggleView()" class="bg-green-500 text-white p-2 rounded">Ver Resumen Mensual</button>
</div>

<!-- Vista del calendario -->
<div id="calendar-view" class="p-4">
    <div id="calendar" class="grid grid-cols-7 gap-2">
        <!-- Días de la semana -->
        <div class="header-day p-2 text-center">Lunes</div>
        <div class="header-day p-2 text-center">Martes</div>
        <div class="header-day p-2 text-center">Miércoles</div>
        <div class="header-day p-2 text-center">Jueves</div>
        <div class="header-day p-2 text-center">Viernes</div>
        <div class="header-day p-2 text-center">Sábado</div>
        <div class="header-day p-2 text-center">Domingo</div>
    </div>
    <div id="calendar-days" class="grid grid-cols-7 gap-2"></div>
</div>

<!-- Vista del resumen -->
<div id="summary-view" class="p-4 hidden">
    <h2 class="text-2xl mb-4">Resumen de Actividades</h2>
    <div id="summary-activities"></div>
    <div id="motivational-message" class="mt-4 text-xl font-bold"></div>
</div>

<script>
    let currentDate = new Date();
    let data = JSON.parse(localStorage.getItem('calendarData')) || {};
    let currentView = 'calendar';
    const sportsList = ["Padel", "Tenis", "Boxeo", "Futbol", "Comba"];

    function saveData() {
        localStorage.setItem('calendarData', JSON.stringify(data));
    }

    function changeMonth(direction) {
        currentDate.setMonth(currentDate.getMonth() + direction);
        updateCalendar();
    }

    function updateCalendar() {
        let month = currentDate.getMonth();
        let year = currentDate.getFullYear();
        document.getElementById('month-title').innerText = `${getMonthName(month)} ${year}`;
        document.getElementById('current-date').innerText = `${getDayName(currentDate.getDay())} ${currentDate.getDate()} de ${getMonthName(month)} ${year}`;

        let firstDay = (new Date(year, month, 1).getDay() + 6) % 7;
        let lastDate = new Date(year, month + 1, 0).getDate();
        let daysHTML = '';

        for (let i = 0; i < 42; i++) {
            let dayNumber = i - firstDay + 1;

            if (dayNumber > 0 && dayNumber <= lastDate) {
                let dateKey = `${year}-${month + 1}-${dayNumber}`;
                let isToday = (new Date()).toDateString() === new Date(year, month, dayNumber).toDateString();
                let checkedData = data[dateKey] || {};

                daysHTML += `
                    <div class="p-2 ${isToday ? 'current-day' : ''} bg-white border rounded">
                        <span class="block text-center font-semibold">${getDayName((i + 1) % 7)} ${dayNumber}</span>
                        <div class="space-y-1 mt-2">
                            <label><input type="checkbox" ${checkedData.exercise ? 'checked' : ''} onchange="toggleActivity(${dayNumber}, 'exercise')" class="mr-1">Ejercicio</label>
                            <label><input type="checkbox" ${checkedData.creatine ? 'checked' : ''} onchange="toggleActivity(${dayNumber}, 'creatine')" class="mr-1">Creatina</label>
                            <label><input type="checkbox" ${checkedData.steps ? 'checked' : ''} onchange="toggleActivity(${dayNumber}, 'steps')" class="mr-1">Meta pasos</label>
                            <input type="number" value="${checkedData.weight || ''}" class="w-full border rounded mt-1 hidden-weight" oninput="setWeight(${dayNumber}, this)" ${checkedData.weight ? '' : 'hidden'}>
                            <select onchange="setFood(${dayNumber}, this)" class="w-full border rounded mt-1 ${getFoodClass(checkedData.food)}">
                                <option ${!checkedData.food ? 'selected' : ''} value="">Comida</option>
                                <option ${checkedData.food === 'Bueno' ? 'selected' : ''} value="Bueno">Bueno</option>
                                <option ${checkedData.food === 'Mejorable' ? 'selected' : ''} value="Mejorable">Mejorable</option>
                                <option ${checkedData.food === 'Normal' ? 'selected' : ''} value="Normal">Normal</option>
                                <option ${checkedData.food === 'Mal' ? 'selected' : ''} value="Mal">Mal</option>
                            </select>
                            <select onchange="addSport(${dayNumber}, this)" class="w-full border rounded mt-1">
                                <option value="">Añadir Deporte</option>
                                ${sportsList.map(sport => `<option value="${sport}">${sport}</option>`).join('')}
                            </select>
                            ${renderSports(checkedData.sports || [], dayNumber)}
                        </div>
                    </div>
                `;
            } else {
                daysHTML += `<div class="p-2"></div>`;
            }
        }

        document.getElementById('calendar-days').innerHTML = daysHTML;
    }

    function toggleActivity(day, activity) {
        let dateKey = getDateKey(day);
        data[dateKey] = data[dateKey] || {};
        data[dateKey][activity] = !data[dateKey][activity];
        saveData();
    }

    function toggleWeight(day, checkbox) {
        let dateKey = getDateKey(day);
        data[dateKey] = data[dateKey] || {};
        let input = checkbox.nextElementSibling;
        input.hidden = !checkbox.checked;
        checkbox.checked ? input.classList.remove('hidden-weight') : delete data[dateKey].weight;
        saveData();
    }

    function setWeight(day, input) {
        let dateKey = getDateKey(day);
        data[dateKey] = data[dateKey] || {};
        data[dateKey].weight = input.value;
        saveData();
    }

    function setFood(day, select) {
        let dateKey = getDateKey(day);
        data[dateKey] = data[dateKey] || {};
        data[dateKey].food = select.value;
        saveData();
        updateCalendar();
    }

    function addSport(day, select) {
        let sport = select.value;
        if (!sport) return;

        let dateKey = getDateKey(day);
        data[dateKey] = data[dateKey] || {};
        data[dateKey].sports = data[dateKey].sports || [];

        if (!data[dateKey].sports.includes(sport)) {
            data[dateKey].sports.push(sport);
        } else {
            data[dateKey].sports = data[dateKey].sports.filter(s => s !== sport);
        }
        saveData();
        updateCalendar();
    }

    function removeSport(day, sport) {
        let dateKey = getDateKey(day);
        data[dateKey].sports = data[dateKey].sports.filter(s => s !== sport);
        saveData();
        updateCalendar();
    }

    function renderSports(sports, day) {
        return sports.map(sport => `
            <label>
                <input type="checkbox" checked onchange="removeSport(${day}, '${sport}')"> ${sport}
            </label>
        `).join('');
    }

    function getDateKey(day) {
        return `${currentDate.getFullYear()}-${currentDate.getMonth() + 1}-${day}`;
    }

    function getFoodClass(food) {
        if (food === 'Bueno') return 'food-good';
        if (food === 'Mejorable') return 'food-improvable';
        if (food === 'Normal') return 'food-normal';
        if (food === 'Mal') return 'food-bad';
        return '';
    }

    function getDayName(day) {
        const days = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
        return days[day];
    }

    function getMonthName(month) {
        const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
        return months[month];
    }

    function updateSummary() {
        let month = currentDate.getMonth();
        let totalDays = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
        let activityCount = { exercise: 0, creatine: 0, steps: 0, food: { Bueno: 0, Mejorable: 0, Normal: 0, Mal: 0 }, sports: 0 };

        for (let key in data) {
            let [year, monthFromKey, day] = key.split('-');
            if (parseInt(monthFromKey) === month + 1) {
                let dayData = data[key];
                activityCount.exercise += dayData.exercise ? 1 : 0;
                activityCount.creatine += dayData.creatine ? 1 : 0;
                activityCount.steps += dayData.steps ? 1 : 0;
                if (dayData.food) activityCount.food[dayData.food]++;
                if (dayData.sports && dayData.sports.length) activityCount.sports += 1;
            }
        }

        let summaryHTML = `
            <p>Gimnasio ${activityCount.exercise}/${totalDays}</p>
            <div class="stat-bar"><div class="stat-progress stat-good" style="width: ${(activityCount.exercise / totalDays) * 100}%"></div></div>
            <p>Creatina ${activityCount.creatine}/${totalDays}</p>
            <div class="stat-bar"><div class="stat-progress stat-good" style="width: ${(activityCount.creatine / totalDays) * 100}%"></div></div>
            <p>Meta pasos ${activityCount.steps}/${totalDays}</p>
            <div class="stat-bar"><div class="stat-progress stat-good" style="width: ${(activityCount.steps / totalDays) * 100}%"></div></div>
            <p>Comida Bueno ${activityCount.food.Bueno}/${totalDays}</p>
            <div class="stat-bar"><div class="stat-progress stat-good" style="width: ${(activityCount.food.Bueno / totalDays) * 100}%"></div></div>
            <p>Comida Mejorable ${activityCount.food.Mejorable}/${totalDays}</p>
            <div class="stat-bar"><div class="stat-progress stat-improvable" style="width: ${(activityCount.food.Mejorable / totalDays) * 100}%"></div></div>
            <p>Comida Normal ${activityCount.food.Normal}/${totalDays}</p>
            <div class="stat-bar"><div class="stat-progress stat-normal" style="width: ${(activityCount.food.Normal / totalDays) * 100}%"></div></div>
            <p>Comida Mal ${activityCount.food.Mal}/${totalDays}</p>
            <div class="stat-bar"><div class="stat-progress stat-bad" style="width: ${(activityCount.food.Mal / totalDays) * 100}%"></div></div>
            <p>Deportes ${activityCount.sports}/${totalDays}</p>
            <div class="stat-bar"><div class="stat-progress stat-sport" style="width: ${(activityCount.sports / totalDays) * 100}%"></div></div>
        `;

        document.getElementById('summary-activities').innerHTML = summaryHTML;
    }

    function toggleView() {
        currentView = currentView === 'calendar' ? 'summary' : 'calendar';
        document.getElementById('calendar-view').classList.toggle('hidden');
        document.getElementById('summary-view').classList.toggle('hidden');
        if (currentView === 'summary') {
            updateSummary();
        }
    }

    updateCalendar();
</script>

</body>
</html>
